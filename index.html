<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Cardboard Example</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/styles.css" />

    <script src="js/third-party/threejs/three.min.js"></script>
    <script src="js/third-party/threejs/StereoEffect.js"></script>
    <script src="js/third-party/threejs/DeviceOrientationControls.js"></script>
    <script src="js/third-party/threejs/OrbitControls.js"></script>
    <script src="js/third-party/threejs/ColladaLoader.js"></script>

  </head>
  <body>
    <div class="world" id="example"></div>

    <iframe src="https://app.emaze.com/@AZCCQWWI/my-name-is-kevin" width="960px" height="540px" seamless webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe><a href="https://www.emaze.com" target="_blank"><img src="//resources.emaze.com/mypres/css/images/embed.png" alt="Powered by emaze" style="margin: 5px; border: none;"></a>



  <script>
    var camera, scene, renderer;
    var effect, controls;
    var element, container;

    var clock = new THREE.Clock();

    var Colors = {
      red:0xf25346,
      white:0xd8d0d1,
      brown:0x59332e,
      pink:0xF5986E,
      brownDark:0x23190f,
      blue:0x68c3c0
    };

    init();
    animate();

    function init() {

      renderer = new THREE.WebGLRenderer({alpha: true , antialias: true});//***這裡 alpha: true, 才能顯示CSS背景色***//
      renderer.shadowMap.enabled = true; // 舊的寫法是renderer.shadowMapEnabled = true;

      element = renderer.domElement;
      container = document.getElementById('example');
      container.appendChild(element);

      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(90, 1, 0.001, 1000);
      camera.position.set(-20, 20, 0);
      scene.add(camera);

      effect = new THREE.StereoEffect(renderer);

      controls = new THREE.OrbitControls(camera, element);
      controls.rotateUp(Math.PI / 4);
      controls.target.set(
        camera.position.x + 0.1,
        camera.position.y,
        camera.position.z
      );
      controls.noZoom = true;
      controls.noPan = true;

      function setOrientationControls(e) {
        if (!e.alpha) {
          return;
        }

        controls = new THREE.DeviceOrientationControls(camera, true);
        controls.connect();
        controls.update();

        element.addEventListener('click', fullscreen, false);

        window.removeEventListener('deviceorientation', setOrientationControls, true);
      }
      window.addEventListener('deviceorientation', setOrientationControls, true);


      var hemisphereLight, shadowLight;
      createLights();

      function createLights() {

        hemisphereLight = new THREE.HemisphereLight(0xaaaaaa,0x000000, 1.2)
        shadowLight = new THREE.DirectionalLight(0xffffff, 0.3);
        shadowLight.position.set(-150, 350, 350);
        shadowLight.castShadow = true;
        shadowLight.shadow.camera.left = -400;
        shadowLight.shadow.camera.right = 400;
        shadowLight.shadow.camera.top = 400;
        shadowLight.shadow.camera.bottom = -400;
        shadowLight.shadow.camera.near = 0.01;
        shadowLight.shadow.camera.far = 1000;


        shadowLight.shadow.mapSize.width = 3000;//數值調高可提升解析度
        shadowLight.shadow.mapSize.height = 3000;//數值調高可提升解析度

        scene.add(hemisphereLight);
        scene.add(shadowLight);
      }


      var texture = THREE.ImageUtils.loadTexture(
        'textures/patterns/checker.png'
      );
      texture.wrapS = THREE.RepeatWrapping;
      texture.wrapT = THREE.RepeatWrapping;
      texture.repeat = new THREE.Vector2(50, 50);
      texture.anisotropy = renderer.getMaxAnisotropy();

      var material = new THREE.MeshPhongMaterial({
        color: 0xffffff,
        specular: 0xffffff,
        shininess: 20,
        shading: THREE.FlatShading,
        map: texture
      });

      var geometry = new THREE.PlaneGeometry(1000, 1000);

      var material3 = new THREE.MeshPhongMaterial({color:Colors.blue, shading:THREE.FlatShading});

      var mesh = new THREE.Mesh(geometry, material);
      mesh.rotation.x = -Math.PI / 2;
      mesh.position.y = -10;
      mesh.receiveShadow = true;
      mesh.castShadow = true;
      scene.add(mesh);






      var geometry3 = new THREE.BoxGeometry(5, 5, 5);


      var mesh3 = new THREE.Mesh(geometry3, material3);
      mesh3.rotation.set(-Math.PI / 3, -Math.PI / 3, 0)
      mesh3.position.set(7, 0, 0);

      mesh3.castShadow = true;
      mesh3.receiveShadow = true;
      scene.add(mesh3);

      var geometry4 = new THREE.BoxGeometry(5, 5, 5);
      var material4 = new THREE.MeshPhongMaterial({color:Colors.pink, shading:THREE.FlatShading});

      var mesh4 = new THREE.Mesh(geometry4, material4);
      mesh4.rotation.x = -Math.PI / 3;
      mesh4.position.set(7, 7.5, 0);
      mesh4.castShadow = true;
      mesh4.receiveShadow = true;
      scene.add(mesh4);

      createModel();

      function createModel() {

        var jsonLoader = new THREE.JSONLoader();

        jsonLoader.load("models/UVwhiteWall.json", addModel1ToScene );



      }



      function addModel1ToScene(geometry,material) {
        var  material01 = new THREE.MeshFaceMaterial(material);
        var jsonModel = new THREE.Mesh (geometry, material01);
        jsonModel.scale.set (0.5, 0.5, 0.5);
        jsonModel.position.set (16,10, -10);
        jsonModel.rotation.set(0,Math.PI, 0 );
        jsonModel.castShadow = true;
        jsonModel.receiveShadow = true;
        scene.add (jsonModel);


      }

      var loader = new THREE.ColladaLoader();
      loader.options.convertUpAxis = true;
      loader.load( 'models/model.dae', function ( collada ) {
        var dae = collada.scene;
        dae.traverse(function (child) {
          child.traverse(function(e) {
            e.castShadow = true;
            e.receiveShadow = true;
          });
        });
        dae.scale.set(1, 1, 1);

        scene.add(dae);
      } );








      window.addEventListener('resize', resize, false);
      setTimeout(resize, 1);
    }

    function resize() {
      var width = container.offsetWidth;
      var height = container.offsetHeight;

      camera.aspect = width / height;
      camera.updateProjectionMatrix();

      renderer.setSize(width, height);
      effect.setSize(width, height);
    }

    function update() {
      resize();

      camera.updateProjectionMatrix();

      controls.update();
    }

    function render() {
      effect.render(scene, camera);
    }

    function animate() {
      requestAnimationFrame(animate);

      update(); // 舊寫法 update(clock.getDelta()); 不懂clock.getDelta意義
      render(); //舊寫法 render(clock.getDelta()); 不懂clock.getDelta意義
    }

    function fullscreen() {
      if (container.requestFullscreen) {
        container.requestFullscreen();
      } else if (container.msRequestFullscreen) {
        container.msRequestFullscreen();
      } else if (container.mozRequestFullScreen) {
        container.mozRequestFullScreen();
      } else if (container.webkitRequestFullscreen) {
        container.webkitRequestFullscreen();
      }
    }
  </script>
  </body>
</html>
